(()=>{"use strict";const e=window.wp.blocks,t=window.wp.element,{useState:a,useEffect:s,useRef:l}=wp.element,n=function(e,t={}){const[n,r]=a({data:null,isLoading:!1,error:null}),o=l(null);return s((()=>(r({data:null,isLoading:!0,error:null}),o.current?.abort(),"undefined"!=typeof AbortController&&(o.current=new AbortController),t={...t,signal:o.current?.signal},(async()=>{try{console.log("Calling: "+e);const a=await fetch(e,t),s=await a.json();a.ok?r({data:s,isLoading:!1,error:null}):r({data:null,isLoading:!1,error:`${s.code} | ${s.message} ${a.status} (${a.statusText})`})}catch(e){r({data:null,isLoading:!1,error:e.message})}})(),()=>{o.current?.abort()})),[e]),n},{InnerBlocks:r,InspectorControls:o,useBlockProps:c,RichText:i}=wp.blockEditor,{TextControl:u,ToggleControl:m,SelectControl:d,BaseControl:p,PanelBody:_}=wp.components,{useState:f}=wp.element,g=e=>{const{session:a,campus:s,careerPath:l}=e,r=`/wp-json/wsu-cost-tables/v1/render-table?session=${a}&campus=${s}&careerPath=${l}`,o=WSUWP_DATA.siteUrl||"",{data:c,isLoading:i,error:u}=n(`${o}${r}`);return i?(0,t.createElement)("p",null,"...loading"):c||i?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{dangerouslySetInnerHTML:{__html:c}})):(0,t.createElement)("p",{className:"wp-block-wsuwp-cost-tables__error"},"Error: No matching table for selected options.")};(0,e.registerBlockType)("wsuwp/cost-tables",{title:"Cost Tables",icon:"money-alt",category:"text",attributes:{default_session:{type:"string",default:""},default_campus:{type:"string",default:""},default_career_path:{type:"string",default:""}},edit:e=>{const{className:a,attributes:s,setAttributes:l}=e,r="wp-block-wsuwp-cost-tables",c=WSUWP_DATA.siteUrl||"",{data:i,isLoading:u,error:m}=n(`${c}/wp-json/wsu-cost-tables/v1/get-cost-table-settings`);if(u)return(0,t.createElement)("p",null,"...loading");if(!i||m)return(0,t.createElement)("p",null,"Error: something went wrong.");const p={sessions:i.taxonomies.sessions.map((e=>({label:e.name,value:e.slug}))),campuses:i.taxonomies.campuses.map((e=>({label:e.name,value:e.slug}))),careerPaths:i.taxonomies.careerPaths.map((e=>({label:e.name,value:e.slug})))};return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:`${r}__filters`},(0,t.createElement)("div",{className:`${r}__filter`},"Year/Session",(0,t.createElement)("span",{className:`${r}__filter-icon dashicons dashicons-arrow-down-alt2`})),(0,t.createElement)("div",{className:`${r}__filter`},"Campus",(0,t.createElement)("span",{className:`${r}__filter-icon dashicons dashicons-arrow-down-alt2`})),(0,t.createElement)("div",{className:`${r}__filter`},"Career Path",(0,t.createElement)("span",{className:`${r}__filter-icon dashicons dashicons-arrow-down-alt2`}))),(0,t.createElement)(g,{session:s.default_session,campus:s.default_campus,careerPath:s.default_career_path}),(0,t.createElement)(o,null,(0,t.createElement)(_,{title:"Cost Table Settings",initialOpen:!0},(0,t.createElement)(d,{label:"Default Session",value:s.default_session?s.default_session:"",options:p.sessions,onChange:e=>l({default_session:e})}),(0,t.createElement)(d,{label:"Default Campus",value:s.default_campus?s.default_campus:"pullman",options:p.campuses,onChange:e=>l({default_campus:e})}),(0,t.createElement)(d,{label:"Default Career Path",value:s.default_career_path?s.default_career_path:"undergraduate",options:p.careerPaths,onChange:e=>l({default_career_path:e})}))))},save:function(){return null}})})();