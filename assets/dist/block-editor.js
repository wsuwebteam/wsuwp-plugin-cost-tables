(()=>{"use strict";const e=window.wp.blocks,t=window.wp.element,{useState:a,useEffect:s,useRef:n}=wp.element,l=function(e,t={}){const[l,r]=a({data:null,isLoading:!1,error:null}),o=n(null);return s((()=>(r({data:null,isLoading:!0,error:null}),o.current?.abort(),"undefined"!=typeof AbortController&&(o.current=new AbortController),t={...t,signal:o.current?.signal},(async()=>{try{console.log("Calling: "+e);const a=await fetch(e,t),s=await a.json();a.ok?r({data:s,isLoading:!1,error:null}):r({data:null,isLoading:!1,error:`${s.code} | ${s.message} ${a.status} (${a.statusText})`})}catch(e){r({data:null,isLoading:!1,error:e.message})}})(),()=>{o.current?.abort()})),[e]),l},r=window.wp.compose,o=window.wp.components;let c=null;const i=e=>{const{label:a="Data Source",className:s,onChange:n,value:l="",placeholder:u="https://example.wsu.edu",help:p="URL for the site to use as the data source (i.e. https://example.wsu.edu). Defaults to the currect site if left empty."}=e,[d,m]=(0,t.useState)(l),[_,h]=(0,t.useState)(!1),f=`inspector-text-control-${(0,r.useInstanceId)(i)}`;function w(e){!function(e){try{new URL(e)}catch(e){return!1}return!0}(e)?h(!1):function(e){return c?.abort(),c="undefined"==typeof AbortController?void 0:new AbortController,fetch(e+"/wp-json/wp/v2/statuses",{method:"GET",signal:c?.signal})}(e).then((t=>{t.ok?(h(!0),n&&n(e)):h(!1)})).catch((e=>{h(!1)}))}return(0,t.useEffect)((()=>{w(d)}),[]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(o.BaseControl,{label:a,id:f,className:s,help:p},(0,t.createElement)("div",{className:"wsu-gutenberg-input-with-icon"},d&&(0,t.createElement)("span",{className:"dashicon wsu-gutenberg-input-with-icon__icon "+(_?"dashicons dashicons-yes wsu-gutenberg-input-with-icon__icon--success":"dashicons dashicons-no-alt wsu-gutenberg-input-with-icon__icon--error")}),(0,t.createElement)("input",{className:"components-text-control__input",type:"text",id:f,value:d,placeholder:u,onChange:e=>async function(e){if(m(e),""===e)return h(!1),void n("");w(e)}(e.target.value),"aria-describedby":f+"__help"}))))},u=i,{useBlockProps:p,InspectorControls:d}=wp.blockEditor,{ToggleControl:m,SelectControl:_,PanelBody:h}=wp.components,{useEffect:f,useMemo:w}=wp.element,g=e=>{const a=p();return(0,t.createElement)("div",a,e.children)},b=e=>{const{host:a,type:s,session:n,campus:r,careerPath:o}=e,c=`/wp-json/wsu-cost-tables/v1/render-table?type=${s}&session=${n}&campus=${r}&careerPath=${o}`,{data:i,isLoading:u,error:p}=l(`${a}${c}`);return u?(0,t.createElement)("p",null,"...loading"):i||u?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{dangerouslySetInnerHTML:{__html:i}})):(0,t.createElement)("p",{className:"wp-block-wsuwp-cost-tables__error"},"Error: No matching table for selected options.")};(0,e.registerBlockType)("wsuwp/cost-tables",{title:"Cost Tables",icon:"money-alt",category:"text",attributes:{initialized:{type:"boolean",default:!1},data_source:{type:"string",default:""},default_type:{type:"string",default:""},default_session:{type:"string",default:""},default_campus:{type:"string",default:""},default_career_path:{type:"string",default:""},show_session_filter:{type:"boolean",default:!0},show_campus_filter:{type:"boolean",default:!0},show_career_path_filter:{type:"boolean",default:!0}},edit:e=>{const{attributes:a,setAttributes:s}=e,n="https://financialaid.wsu.edu",r="wp-block-wsuwp-cost-tables",o=[{label:"",value:""}],c=a.data_source||WSUWP_COST_TABLES_DATA.siteUrl||"",{data:i,isLoading:p,error:E}=l(`${c}/wp-json/wsu-cost-tables/v1/get-cost-table-settings`),y=w((()=>i?{types:i.taxonomies?.types.map((e=>({label:e.name,value:e.slug}))),sessions:i.taxonomies?.sessions.map((e=>({label:e.name,value:e.slug}))),campuses:i.taxonomies?.campuses.map((e=>({label:e.name,value:e.slug}))),careerPaths:i.taxonomies?.careerPaths.map((e=>({label:e.name,value:e.slug})))}:null),[i]);function v(e,t,s){var n;Array.isArray(t)&&!function(e,t){return t.some((t=>t.value===e))}(a[e],t)&&(s[e]=(n=t)&&n[0]&&n[0].value?n[0].value:"")}return f((()=>{const e={};!1===a.initialized&&(e.initialized=!0,e.data_source=n,e.default_campus="global",e.default_career_path="undergraduate"),y&&(v("default_type",y.types,e),v("default_session",y.sessions,e),v("default_campus",y.campuses,e),v("default_career_path",y.careerPaths,e)),Object.keys(e).length>0&&s(e)}),[y]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(g,null,p&&(0,t.createElement)("p",null,"...loading"),!p&&(!i||E)&&(0,t.createElement)("p",{className:`${r}__api-error`},(0,t.createElement)("span",{className:`${r}__api-error-icon dashicons dashicons-warning`}),"Error: something went wrong requesting information from the data source."),i&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:`${r}__filters`},a.show_session_filter&&(0,t.createElement)("div",{className:`${r}__filter`},"Year/Session",(0,t.createElement)("span",{className:`${r}__filter-icon dashicons dashicons-arrow-down-alt2`})),a.show_campus_filter&&(0,t.createElement)("div",{className:`${r}__filter`},"Campus",(0,t.createElement)("span",{className:`${r}__filter-icon dashicons dashicons-arrow-down-alt2`})),a.show_career_path_filter&&(0,t.createElement)("div",{className:`${r}__filter`},"Career Path",(0,t.createElement)("span",{className:`${r}__filter-icon dashicons dashicons-arrow-down-alt2`}))),(0,t.createElement)(b,{host:c,type:a.default_type,session:a.default_session,campus:a.default_campus,careerPath:a.default_career_path}))),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(d,null,(0,t.createElement)(h,{title:"Cost Table Settings",initialOpen:!0},(0,t.createElement)(_,{label:"Table Type",value:a.default_type,options:y?.types||o,onChange:e=>s({default_type:e})}),(0,t.createElement)(_,{label:"Default Session",value:a.default_session,options:y?.sessions||o,onChange:e=>s({default_session:e})}),(0,t.createElement)(_,{label:"Default Campus",value:a.default_campus,options:y?.campuses||o,onChange:e=>s({default_campus:e})}),(0,t.createElement)(_,{label:"Default Career Path",value:a.default_career_path,options:y?.careerPaths||o,onChange:e=>s({default_career_path:e})}),(0,t.createElement)(m,{label:"Show Year/Session Filter",checked:a.show_session_filter,onChange:e=>s({show_session_filter:e})}),(0,t.createElement)(m,{label:"Show Campus Filter",checked:a.show_campus_filter,onChange:e=>s({show_campus_filter:e})}),(0,t.createElement)(m,{label:"Show Career Path Filter",checked:a.show_career_path_filter,onChange:e=>s({show_career_path_filter:e})}),(0,t.createElement)(u,{label:"Data Source",value:a.initialized?a.data_source:n,onChange:e=>s({data_source:e})})))))},save:function(){return null}})})();