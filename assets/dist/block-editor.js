(()=>{"use strict";const e=window.wp.blocks,t=window.wp.element,{useState:a,useEffect:s,useRef:n}=wp.element,l=function(e,t={}){const[l,r]=a({data:null,isLoading:!1,error:null}),o=n(null);return s((()=>(r({data:null,isLoading:!0,error:null}),o.current?.abort(),"undefined"!=typeof AbortController&&(o.current=new AbortController),t={...t,signal:o.current?.signal},(async()=>{try{console.log("Calling: "+e);const a=await fetch(e,t),s=await a.json();a.ok?r({data:s,isLoading:!1,error:null}):r({data:null,isLoading:!1,error:`${s.code} | ${s.message} ${a.status} (${a.statusText})`})}catch(e){r({data:null,isLoading:!1,error:e.message})}})(),()=>{o.current?.abort()})),[e]),l},r=window.wp.compose,o=window.wp.components;let c=null;const i=e=>{const{label:a="Data Source",className:s,onChange:n,value:l="",placeholder:u="https://example.wsu.edu",help:p="URL for the site to use as the data source (i.e. https://example.wsu.edu). Defaults to the currect site if left empty."}=e,[d,m]=(0,t.useState)(l),[_,h]=(0,t.useState)(!1),f=`inspector-text-control-${(0,r.useInstanceId)(i)}`;function w(e){!function(e){try{new URL(e)}catch(e){return!1}return!0}(e)?h(!1):function(e){return c?.abort(),c="undefined"==typeof AbortController?void 0:new AbortController,fetch(e+"/wp-json/wp/v2/statuses",{method:"GET",signal:c?.signal})}(e).then((t=>{t.ok?(h(!0),n&&n(e)):h(!1)})).catch((e=>{h(!1)}))}return(0,t.useEffect)((()=>{w(d)}),[]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(o.BaseControl,{label:a,id:f,className:s,help:p},(0,t.createElement)("div",{className:"wsu-gutenberg-input-with-icon"},d&&(0,t.createElement)("span",{className:"dashicon wsu-gutenberg-input-with-icon__icon "+(_?"dashicons dashicons-yes wsu-gutenberg-input-with-icon__icon--success":"dashicons dashicons-no-alt wsu-gutenberg-input-with-icon__icon--error")}),(0,t.createElement)("input",{className:"components-text-control__input",type:"text",id:f,value:d,placeholder:u,onChange:e=>async function(e){if(m(e),""===e)return h(!1),void n("");w(e)}(e.target.value),"aria-describedby":f+"__help"}))))},u=i,{InspectorControls:p}=wp.blockEditor,{ToggleControl:d,SelectControl:m,PanelBody:_}=wp.components,h=e=>{const{host:a,type:s,session:n,campus:r,careerPath:o}=e,c=`/wp-json/wsu-cost-tables/v1/render-table?type=${s}&session=${n}&campus=${r}&careerPath=${o}`,{data:i,isLoading:u,error:p}=l(`${a}${c}`);return u?(0,t.createElement)("p",null,"...loading"):i||u?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{dangerouslySetInnerHTML:{__html:i}})):(0,t.createElement)("p",{className:"wp-block-wsuwp-cost-tables__error"},"Error: No matching table for selected options.")};(0,e.registerBlockType)("wsuwp/cost-tables",{title:"Cost Tables",icon:"money-alt",category:"text",attributes:{initialized:{type:"boolean",default:!1},data_source:{type:"string",default:""},default_type:{type:"string",default:""},default_session:{type:"string",default:""},default_campus:{type:"string",default:""},default_career_path:{type:"string",default:""},show_session_filter:{type:"boolean",default:!0},show_campus_filter:{type:"boolean",default:!0},show_career_path_filter:{type:"boolean",default:!0}},edit:e=>{const{className:a,attributes:s,setAttributes:n}=e,r="wp-block-wsuwp-cost-tables",o=s.data_source||WSUWP_COST_TABLES_DATA.siteUrl||"",{data:c,isLoading:i,error:f}=l(`${o}/wp-json/wsu-cost-tables/v1/get-cost-table-settings`);if(i)return(0,t.createElement)("p",null,"...loading");const w=c?{types:c.taxonomies.types.map((e=>({label:e.name,value:e.slug}))),sessions:c.taxonomies.sessions.map((e=>({label:e.name,value:e.slug}))),campuses:c.taxonomies.campuses.map((e=>({label:e.name,value:e.slug}))),careerPaths:c.taxonomies.careerPaths.map((e=>({label:e.name,value:e.slug})))}:null;if(!c||f)return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",{className:`${r}__api-error`},(0,t.createElement)("span",{className:`${r}__api-error-icon dashicons dashicons-warning`}),"Error: something went wrong requesting information from the data source."),g());function g(){return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(p,null,(0,t.createElement)(_,{title:"Cost Table Settings",initialOpen:!0},w&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)(m,{label:"Table Type",value:s.default_type,options:w.types,onChange:e=>n({default_type:e})}),(0,t.createElement)(m,{label:"Default Session",value:s.default_session,options:w.sessions,onChange:e=>n({default_session:e})}),(0,t.createElement)(m,{label:"Default Campus",value:s.default_campus,options:w.campuses,onChange:e=>n({default_campus:e})}),(0,t.createElement)(m,{label:"Default Career Path",value:s.default_career_path,options:w.careerPaths,onChange:e=>n({default_career_path:e})})),(0,t.createElement)(d,{label:"Show Year/Session Filter",checked:s.show_session_filter,onChange:e=>n({show_session_filter:e})}),(0,t.createElement)(d,{label:"Show Campus Filter",checked:s.show_campus_filter,onChange:e=>n({show_campus_filter:e})}),(0,t.createElement)(d,{label:"Show Career Path Filter",checked:s.show_career_path_filter,onChange:e=>n({show_career_path_filter:e})}),(0,t.createElement)(u,{label:"Data Source",value:s.data_source,onChange:e=>n({data_source:e})}))))}return!1===s.initialized&&n({initialized:!0,data_source:"https://financialaid.wsu.edu",default_type:w.types[0].value,default_session:w.sessions[0].value,default_campus:"pullman",default_career_path:"undergraduate"}),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:`${r}__filters`},s.show_session_filter&&(0,t.createElement)("div",{className:`${r}__filter`},"Year/Session",(0,t.createElement)("span",{className:`${r}__filter-icon dashicons dashicons-arrow-down-alt2`})),s.show_campus_filter&&(0,t.createElement)("div",{className:`${r}__filter`},"Campus",(0,t.createElement)("span",{className:`${r}__filter-icon dashicons dashicons-arrow-down-alt2`})),s.show_career_path_filter&&(0,t.createElement)("div",{className:`${r}__filter`},"Career Path",(0,t.createElement)("span",{className:`${r}__filter-icon dashicons dashicons-arrow-down-alt2`}))),(0,t.createElement)(h,{host:o,type:s.default_type,session:s.default_session,campus:s.default_campus,careerPath:s.default_career_path}),g())},save:function(){return null}})})();